+++
title = "Scraping"
author = ["Hrishikesh Barman"]
draft = false
+++

tags
: [System Design]({{< relref "20230113141133-system_design.md" >}}),[Archival]({{< relref "20230115032923-archival.md" >}})


## FAQ {#faq}


### Good resources? {#good-resources}

-   <https://github.com/TheWebScrapingClub/webscraping-from-0-to-hero>
-   <https://github.com/lorien/awesome-web-scraping/tree/master> : Awesome list of tools


### Legal? {#legal}

-   [Are website terms of use enforced?](https://blog.apify.com/enforceability-of-terms-of-use/)


### Headless non-headless {#headless-non-headless}

-   headless: no gui (eg. webscraping)
-   non-headless: gui, visual rendering (eg. if user needs to keep seeing what the automation does)


### What are diff kinds of scraping bots? {#what-are-diff-kinds-of-scraping-bots}

This list i'll keep updating

-   Sneaker bot: commonly referred to as a “shoe bot”, is a sophisticated software component designed to help individuals quickly purchase limited availability stock.


## Related practices {#related-practices}


### Enumeration {#enumeration}

-   [Enumerate/Bruteforce/Attack All the Things! Presenting Legba](https://www.evilsocket.net/2023/11/02/Enumerate-Bruteforce-Attack-All-The-Things-Presenting-Legba/)


### Discovery/mining {#discovery-mining}

-   [adbar/trafilatura](https://github.com/adbar/trafilatura)
    -   Designed to gather text on the Web(raw HTML to essential parts, including metadata)
    -   Better alternative to newspapaer3k etc. See [Article extraction benchmark](https://github.com/scrapinghub/article-extraction-benchmark)
    -   also see <https://github.com/postlight/parser>
-   [medialab/minet](https://github.com/medialab/minet)
    -   Doesn't seem too powerful to me but can have basic abstraction for few basic tasks
    -   A webmining CLI tool &amp; library for python. (uses bs4, playwright etc)


### Orchestrating {#orchestrating}

-   [OptimalBits/bull](https://github.com/OptimalBits/bull) : [Message Queue (MQ)]({{< relref "20240501121916-message_queue.md" >}}) for nodeJS


### Archiving {#archiving}

See [Archival]({{< relref "20230115032923-archival.md" >}})


### Change detection {#change-detection}

-   [thp/urlwatch](https://github.com/thp/urlwatch): Watch (parts of) webpages and get notified when something changes via e-mail, on your phone or via other means. Highly configurable.
-   [paschmann/changd](https://github.com/paschmann/changd): Changd is a open source web monitoring application for monitoring visual site changes using screenshots, XPath's or API's.
-   [dgtlmoon/changedetection.io](https://github.com/dgtlmoon/changedetection.io): Has a browser ext. Sort of commercial even if oss.
-   [visualping](https://visualping.io/): commercial service


### Reconnaissance {#reconnaissance}

-   Basically examining the target
-   Also see Checklist &amp; Best Practices


### Post processing {#post-processing}


#### Summarization {#summarization}

-   See [Open Source LLMs]({{< relref "20230719050449-open_source_llms.md" >}})
-   [jbrooksuk/node-summary](https://github.com/jbrooksuk/node-summary)


#### NLP tasks {#nlp-tasks}


#### Cleanup and parsing {#cleanup-and-parsing}

-   See [simonw/strip-tags](https://github.com/simonw/strip-tags) and [postlight/parser](https://github.com/postlight/parser) for cleanup
-   See [nodemailer/mailparser](https://github.com/nodemailer/mailparser)


## Checklist &amp; Best Practices {#checklist-and-best-practices}


### Checklist {#checklist}

-   [ ] Using something like wappalyzer find out tech used/projection used etc.
-   [ ] Does the website have an API (internal or exposed)?
-   [ ] Does it have some JSON inside the HTML? Eg. site might preload JSON payloads into the initial HTML for hydration.
-   [ ] **Think beyond DOM scraping**
    -   [ ] Does it even need scraping or I can just make an API call
    -   [ ] Does it include a `static` [session]({{< relref "20231102113142-web_sessions.md" >}}) header?
    -   [ ] Does it include a `dynamic` [session]({{< relref "20231102113142-web_sessions.md" >}}) header?
    -   [ ] Does it dump things to the `heap` that we can use objects from it?
-   [ ] If it's DOM based scraping and we using Playwright, can we get around using [codegen](https://playwright.dev/docs/codegen)?
-   [ ] Is the data being served via iframe? in that case we check the source of the frame.
-   [ ] Does it makes certain requests only from mobile app? TODO: How do we catch these?
-   [ ] Is the data being rendered via canvas, so no [DOM]({{< relref "20230614133347-dom.md" >}}) at all? Maybe tools [shot-scraper](https://shot-scraper.datasette.io), [ishan0102/vimGPT](https://github.com/ishan0102/vimGPT), [OpenAdapt](https://github.com/OpenAdaptAI/OpenAdapt),[mayt/BrowserGPT](https://github.com/mayt/BrowserGPT)  can help?


### Best practices {#best-practices}


#### Sites with dynamic sessions {#sites-with-dynamic-sessions}

-   These usually need complex combination of temporary auth token headers which is difficult to do outside the context of the app/expire etc.
-   In these cases, we sort of would need to automate the task of "inspecting the network tab". Application context can help. (See [Page.setRequestInterception()](https://pptr.dev/api/puppeteer.page.setrequestinterception), [Network Events | Playwright](https://playwright.dev/docs/network#network-events))
-   Sometimes they may even be predictable in some way.


#### Sites with data in the runtime Heap {#sites-with-data-in-the-runtime-heap}

-   Eg. find the apollo client instance in memory, use it to get the data. Profit? (See [adriancooney/puppeteer-heap-snapshot](https://github.com/adriancooney/puppeteer-heap-snapshot/tree/master), this will work with playwright as-well because uses the [CDP](https://playwright.dev/docs/api/class-cdpsession)).
-   This can be slow but nice because even if the UI changes frequently, the underlying data-structure to store the data might not etc.


#### DOM based scraping {#dom-based-scraping}

-   We try using playwright codegen if possible
-   Don't use XPath&amp;CSS selectors at all (Except if you don't have choice). You rely on more generic stuff, e.g, "the button that has 'Sign in' on it": `await page.getByRole('button', { name: 'Sign in' }).click();`


### Other ideas {#other-ideas}

{{< figure src="/ox-hugo/20230115032823-scraping-1919827806.png" >}}


## Antibot stuff {#antibot-stuff}


### Antibot Protection {#antibot-protection}

If anti-bot detects your fingerprint or you raise suspicion, you get captcha. Idea is to detect which anti-bot mechanism is at play and then use bypassing techniques when scraping. w some anti-bot tools, you may not even need to use headless browser, maybe just [using rotating proxies will solve it.](https://www.zenrows.com/blog/bypass-akamai)


#### Fingerprinting {#fingerprinting}

See [Anonymity]({{< relref "20230212154657-anonymity.md" >}})

<!--list-separator-->

-  Passive

    This is usually not under your control. You can try changing devices etc.

    -   TCP/IP: IPv4 and IPv6 headers, TCP headers, the dynamics of the TCP handshake, and the contents of application-level payloads. (See [p0f](https://en.wikipedia.org/wiki/P0f))
    -   [TLS]({{< relref "20230210181907-tls.md" >}}): The TLS handshake is not encrypted and can be used [for finger printing](https://blog.squarelemon.com/tls-fingerprinting/).
    -   [HTTP]({{< relref "20230222161545-http.md" >}}) : Special frames in the packet that differ by clients so that we can fingerprint the client etc. [SETTINGS/WINDOW_UPDATE/PRIORITY](https://github.com/TheWebScrapingClub/webscraping-from-0-to-hero/blob/main/Pages/5.Antibot/Akamai_WP_Passive_Fingerprinting.pdf) for [HTTP/2]({{< relref "20230222161545-http.md#http-2" >}})

<!--list-separator-->

-  Active

    In this case, the website tries to run certain tests back on you to check if your fingerprint matches and do whatever action it desires to based on that info

    -   Canvas Fingerprinting: This may try to render something which may [render differently](https://fingerprint.com/blog/canvas-fingerprinting/) in a personal computer vs a vm etc. WebGL Fingerprinting also works similarly.


#### Products offering protection {#products-offering-protection}

-   [Datadome](https://substack.thewebscraping.club/t/datadome)
-   [PerimeterX](https://substack.thewebscraping.club/t/perimeterx)
-   [Kasada](https://substack.thewebscraping.club/t/kasada)
-   Cloudflare
    -   You could also get creative eg. if we can somehow figure out the origin ip somehow(DNS leak, logs, subdomains etc.). But this would only work if the site admin somehow forgot to add [firewalls]({{< relref "20230306125249-firewalls.md" >}}) rules to allow only traffic from cf
-   OSS
    -   [Open-source JavaScript Bot Detection Library](https://fingerprint.com/products/bot-detection/)
    -   [omrilotan/isbot](https://github.com/omrilotan/isbot)


### Antibot solutions {#antibot-solutions}


#### Proxy services {#proxy-services}

> I'll just say that firefox still runs tampermonkey, and that includes firefox mobile, so depending on how often you need a different IP and how much data you're getting, you might be able to do away with the whole idea of proxies and just have a few mobile phones that can be configured as workers that take requests through a tampermonkey script. Or that a laptop tethers to that does the same, or that runs puppeteer itself. It depends on whether a worker needs a new IP every few minutes, hours or days as to whether a real mobile phone works (as some manual interaction is often required to actively change the IP). - kbenson

-   Residential/Mobile
-   4G rotating proxies??


#### Captcha solvers {#captcha-solvers}

-   [2Captcha](https://2captcha.com/?from=3019071)
-   [Abusing Ahrefs backlink checker | Hacker News](https://news.ycombinator.com/item?id=36491313)


#### Obfuscate fingerprint {#obfuscate-fingerprint}

-   May require playing w JS
-   Manage cookies/headers
-   Crack backend APIs and so on.


#### Other configs {#other-configs}

-   There are always specific config that you'll need to trial and error. eg. some sites might not like headless, so you gotta scrape with no-headless or something similar


#### Pre-made solutions {#pre-made-solutions}

-   These usually do the job of Proxy services + Obfuscating fingerprints
-   [Bright data](https://brightdata.com/), Zyte API, Smart Proxy and Oxylabs Web Unlocker


## Tools {#tools}


### Ready2Go Solutions {#ready2go-solutions}

| Name        | USP                                               | Use                                     |
|-------------|---------------------------------------------------|-----------------------------------------|
| BrightData  | Built for devs                                    | Custom public scrapers                  |
| Diffbot     | Structured data extractions &amp; datasets        | Market research, public data extraction |
| Apify       | No code                                           | ?                                       |
| Octoparse   | No code                                           | ?                                       |
| ScrapingBee | Manages headless browsers for you                 |                                         |
| zyte        | scrapinghub renamed to zyte, they maintain scrapy |                                         |
| SerpAPI     | Google search as API                              |                                         |


### Social Media {#social-media}


#### Twitter {#twitter}

-   [twarc2 (en) - twarc](https://twarc-project.readthedocs.io/en/latest/twarc2_en_us/#configure)
-   [snscrape](https://github.com/JustAnotherArchivist/snscrape) : This does more than twitter scraping btw


#### Reddit {#reddit}

-   <https://github.com/mattpodolak/pmaw> (uses pushshift)
-   <https://praw.readthedocs.io> (API wrapper)
-   <https://redditsearchtool.com/>


#### YT {#yt}

-   <https://blog.0x7d0.dev/history/how-they-bypass-youtube-video-download-throttling/>
-   <https://news.ycombinator.com/item?id=37117338>


### Other tools {#other-tools}

-   [borisbabic/browser_cookie3](https://github.com/borisbabic/browser_cookie3)


## Crawlee Primer {#crawlee-primer}

-   currently supports 3 main crawlers
-   There's request and requestQueue that crawlee offers. These are low level
-   Every crawler has an implicit RequestQueue instance, and you can add requests to it with the crawler.addRequests() method.


## Resources {#resources}


### War stories {#war-stories}

-   So... I built a [Browser Extension]({{< relref "20230819201918-browser_extensions.md" >}}) to grab the data at a speed that is usually under their detection rate. Basically created a distributed scraper and passed it out to as many people in the league as I could.
    -   I found that tampermonkey is often much easier to deal with in most cases and also much quicker to develop for
    -   some sites can block 'self' origin scripts by leaving it out of the [CSP]({{< relref "20230616121539-xss.md#csp" >}}) and only allowing scripts they control served by a CDN


### Others {#others}

-   [The most important HTTP headers for scraping | Colly](https://go-colly.org/articles/scraping_related_http_headers/)
-   [Web Scraping: Bypassing “403 Forbidden,” captchas, and more | Hacker News](https://news.ycombinator.com/item?id=13884357)
