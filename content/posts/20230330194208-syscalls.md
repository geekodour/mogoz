+++
title = "syscalls"
author = ["Hrishikesh Barman"]
draft = false
+++

tags
: [Linux]({{< relref "20221101150211-linux.md" >}})


## Important Resources {#important-resources}

-   [ChromiumOS Docs - Linux System Call Table](https://chromium.googlesource.com/chromiumos/docs/+/HEAD/constants/syscalls.md#x86_64-64_bit)
-   [The Definitive Guide to Linux System Calls | Packagecloud Blog](https://blog.packagecloud.io/the-definitive-guide-to-linux-system-calls/)
-   `ausyscall --dump` : List syscalls in the system


## Other resources {#other-resources}

-   [1001 Ways of Implementing a System Call | x86.lol](https://x86.lol/generic/2019/07/04/kernel-entry.html)
-   [Tutorial - Write a System Call • Stephen Brennan](https://brennan.io/2016/11/14/kernel-dev-ep3/)


## Kernel and CPU {#kernel-and-cpu}

-   This happens via [Interrupts]({{< relref "20221101173720-interrupts.md" >}})
-   [What are the calling conventions for UNIX &amp; Linux system calls](https://stackoverflow.com/questions/2535989/what-are-the-calling-conventions-for-unix-linux-system-calls-and-user-space-f/2538212#2538212)
-   [How syscalls work in rust](https://www.reddit.com/r/rust/comments/n8iq0f/how_does_the_rust_standard_library_work/)


## Entry points into the kernel {#entry-points-into-the-kernel}

-   syscalls
-   exceptions
-   traps


## Directory {#directory}


### General notes {#general-notes}

-   For notifications coming from kernel, returning a new file descriptor for the relevant object allows userspace to use `poll/select/epoll` to receive that notification.
-   Operations that don’t map to `read(2)` / `write(2)`-like have to use as `ioctl(2)`


### Memory {#memory}


#### brk/sbrk {#brk-sbrk}

We have a syscall to do this, `brk` and `sbrk` (wrapper around `brk` that allows a increment rather than direct address unlike `brk`), when we are using `brk` it gives us new memory based on the page size(see obj header diagram above)


#### mmap {#mmap}

{{< figure src="/ox-hugo/20230330194208-syscalls-509177890.png" >}}

-   See [mmap]({{< relref "20230405022848-mmap.md" >}})


#### mlock {#mlock}

-   When `mlock` is set, it won't flush that portion into swap.
-   [Misunderstanding mlock(2) and mlockall(2)](https://eklitzke.org/mlock-and-mlockall)

<!--list-separator-->

-  What it for?

    -   programs that need to store passwords or sensitive decrypted data in memory (See [Vault and mlock() – HashiCorp Help Center](https://support.hashicorp.com/hc/en-us/articles/115012787688-Vault-and-mlock-))
    -   programs that need to operate in a real-time environment

<!--list-separator-->

-  What it not for but used for

    -   Increasing performance by letting things not go to swap. In these cases you might aswell just disable swap for that program([cgroups]({{< relref "20230304201630-cgroups.md" >}})) rather than setting mlock.
    -   Some systems still [will swap even if you set mlock](https://github.com/elastic/elasticsearch/issues/58092)


### Process {#process}


#### clone {#clone}

-   pthreads uses close to spwan threads??


#### fork {#fork}

-   It creates a child process whose page table is a clone of the parent


### Advice {#advice}

These are only acting advisory. The kernel is not obligated to follow them.


#### fadvice {#fadvice}


#### madvice {#madvice}
