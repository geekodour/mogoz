+++
title = "HTTP"
author = ["Hrishikesh Barman"]
draft = false
+++

tags
: [Web Development]({{< relref "20221108105344-web_development.md" >}})


## Meta {#meta}


### Connection vs Request {#connection-vs-request}


#### Connections {#connections}

-   client and server introduce themselves
-   HTTP1.1 and HTTP/2 uses TCP while HTTP/3 uses QUIC which is based on UDP.


#### Requests {#requests}

-   client ask something from server
-   To make a HTTP1.1 or HTTP2 request you need to have an active connection w the server.
-   Eg. An endpoint accepts 5 connections and 10 requests from given IP address.


### Browsers {#browsers}

-   Browsers usually limit 6 connections per origin(scheme, host, and port). Be it HTTP1.1 or HTTP2.


## 1.1,2,3 What? {#1-dot-1-2-3-what}

HTTP's "core" semantics donâ€™t change between protocol versions. i.e **most of the time** `methods` and `status codes`, `header fields` mean the same thing no matter what version of the protocol you use(HTTP/1.1, HTTP/2, HTTP/3)


### HTTP/1.1 {#http-1-dot-1}

-   Written in 1997
-   RFC revised in 2013
-   RFC again revised in 2022
-   HTTP/1.1 suffers from **Head of line(HOL)** blocking. Each browser/client has a limited number of connections to a server and doing a new request over one of those connections has to wait for the ones to complete before it can fire it off.
-   w HTTP1.1, browser can make `1 request/connection` but in-reality, they make multiple connections in parallel to the server.
-   Because of limited requests servers used to concat assets and do things like css sprites to reduce number of requests. But we don't have this issue w HTTP2 because no. of request is not a problem for HTTP2.
-   HTTP1.1 can still send multiple request in a connection using [pipelining](https://en.wikipedia.org/wiki/HTTP_pipelining) but that's not widely supported and has other problems.


### HTTP/2 {#http-2}

-   Prior to HTTP/2, WG attempted [HTTP_NG](https://www.w3.org/Protocols/HTTP-NG/)
-   [Introduced](https://blog.cloudflare.com/http-2-for-web-developers/) in 2015 and then RFC revised in 2022.
-   HTTP2 does the same thing as HTTP3/QUIC but on top of `TCP`
-   It introduced primarily 2 things, multplexing and server push thing. server push thing made john wick his enemy.


#### Multiplexing {#multiplexing}

{{< figure src="/ox-hugo/20230222161545-http-1777171190.png" >}}

-   HTTP2 adds multiplexing where we can make multiple `request` per `connection`. So no need to make multiple connections.
-   With this we do not delay sending of requests, no waiting for a free connection. All these requests make their way through the Internet to the server in (almost) parallel. The server responds to each one, and then they start to make their way back.

<!--list-separator-->

-  Dealing w HOL

    -   Web server can respond to them in any order it feels like and send back files in different order, or even break each file requested into pieces and intermingle the files together.
    -   This has the secondary benefit of one heavy request not blocking all the other subsequent requests i.e HOL.
    -   It addresses HOL by TCP multiplexing, but still have an underlying issue at `TCP` level. Because TCP is reliable delivery protocol, Loss of a single packet in a flow can block access to those after it. This happens often and seamlessly but HTTP3 makes this better w QUIC.
    -   Because of this, HTTP2's stream multiplexing works really well on good connections but terribly on bad.
    -   2021: [QUICv1](https://blog.cloudflare.com/quic-version-1-is-live-on-cloudflare/) was released to **replace** `TCP` . (QUIC uses UDP)


#### Ordering and Prioritization {#ordering-and-prioritization}

-   HTTP2 allows [request prioritization](https://blog.cloudflare.com/better-http-2-prioritization-for-a-faster-web/) for the client (browser)
-   But it is up to the server to decide what to do based on the request.
-   The server is free to not respect the prioritization request and process data at its own will.


#### Server Push GW {#server-push-gw}

-   Added [Server Push]({{< relref "20230222180346-server_push.md" >}}): Servers can send `req/res pair` to clients in advance to make things faster
-   Issue: Server predicting what the client needs is hard. Network conditions, client can have cache, over-pushing, conflict with real request for the same degrading performance
-   Chrome ended up removing `server push` in 2022. Community says it's only suitable for certain usecases. Has [Early Hints](https://httpwg.org/specs/rfc8297.html) as an alternative.
-   [HTTP/2 Push is dead](https://evertpot.com/http-2-push-is-dead/) | [HTTP/2 upload speed](https://blog.cloudflare.com/delivering-http-2-upload-speed-improvements/) | [Why HTTP/2 is slower than HTTPS?](https://stackoverflow.com/questions/33658302/why-http-2-is-slower-than-plain-https)


### HTTP/3 {#http-3}

-   HTTP/3 is `HTTP/2-Over-QUIC` by design (Analogy)
-   [HTTP/3](https://blog.cloudflare.com/cloudflare-view-http3-usage/) is the version of HTTP that uses `QUIC` and does not suffer from HOLB.
-   Advantage of HTTP3 is that you only need to block the affected streams while retransmitting unlike HTTP2 where you need to block all streams.
-   Requires CA based TLS to set up a connection.


#### More on QUIC for HTTP3 {#more-on-quic-for-http3}

-   Idea of using UDP for QUIC is that, TCP's handshakes and acknowledges are redundant when you have it all anyway on L7, so they choose a simpler UDP as transport and re-implement handshakes and acknowledges in their applied protocols.
-   QUIC is over UDP for backwards compatibility, it was going to be its own protocol


## Going Deeper {#going-deeper}


### Making a raw request {#making-a-raw-request}

```shell
# netcat usage to make a HTTP/1.1 req
$ printf 'HEAD / HTTP/1.1\r\nHost: neverssl.com\r\nConnection: close\r\n\r\n' | nc neverssl.com 80

# NOTE: \r\n is known as CRLF(Carriage Return + Line Feed)
```


### Host field {#host-field}

> TODO: IDK what is the type of Host, what it is actually, i understadn what it does tho.

```shell
Host: neverssl.com
```

-   With this, we can now host different websites at the same IP address
-   But not all servers check it! So you can set `Host` and whether it gets used or not totally depends on the server.

<div class="warning small-text">

> TODO: How is this different from SNI?
</div>


## Future areas of focus {#future-areas-of-focus}

These are areas where the WG is more active of recent


### Privacy {#privacy}

-   [MASQUE](https://ietf-wg-masque.github.io/) enabled UDP tunnels. This enhances HTTP.
-   MASQUE along with [IP Tunneling](https://blog.cloudflare.com/unlocking-quic-proxying-potential/) can possibly have us MASQUE VPN. Also check [OHTTP](https://www.ietf.org/archive/id/draft-ietf-ohai-ohttp-06.html)


### Security {#security}

-   Replaces `digest` header <https://httpwg.org/http-extensions/draft-ietf-httpbis-digest-headers.html>
-   Formalizes Message signatatures: <https://httpwg.org/http-extensions/draft-ietf-httpbis-message-signatures.html>
-   Cookie spec revised: <https://httpwg.org/http-extensions/draft-ietf-httpbis-rfc6265bis.html>


### Others ideas being explored {#others-ideas-being-explored}

-   HTTP over Websockets and Web Transport
-   QUERY (GET w body)
-   Resumable Uploads


## Keep hearing these terms, dn what {#keep-hearing-these-terms-dn-what}

-   Header and trailer fields
-   structured header fields


## Resources {#resources}


### RFC {#rfc}

-   The HTTP core RFCs
    -   Semantics: <https://www.rfc-editor.org/rfc/rfc9110>
    -   Caching: <https://www.rfc-editor.org/rfc/rfc9111>
    -   HTTP/1.1: <https://www.rfc-editor.org/rfc/rfc9112>
    -   HTTP/2: <https://www.rfc-editor.org/rfc/rfc9113>
    -   HTTP/3: <https://www.rfc-editor.org/rfc/rfc9114> (QUIC: <https://www.rfc-editor.org/rfc/rfc9000>)


### QUIC {#quic}

-   [RPC vs TCP (Redux) - by Larry Peterson - Systems Approach](https://systemsapproach.substack.com/p/rpc-vs-tcp-redux)
-   [It's TCP vs. RPC All Over Again - by Larry Peterson](https://systemsapproach.substack.com/p/its-tcp-vs-rpc-all-over-again)
-   [QUIC Is Not a TCP Replacement - by Bruce Davie](https://systemsapproach.substack.com/p/quic-is-not-a-tcp-replacement)
-   [Chris's Wiki blog/web/AvoidingHTTP3ForNow](https://utcc.utoronto.ca/~cks/space/blog/web/AvoidingHTTP3ForNow)


### WG {#wg}

-   Source of truth: <https://httpwg.org/specs/>
-   QUIC WG: <https://quicwg.org/>


### Other {#other}

-   HTTP Field Name registry: <https://www.iana.org/assignments/http-fields/>
-   Caching tests: <https://cache-tests.fyi/>
