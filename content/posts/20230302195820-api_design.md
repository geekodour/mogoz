+++
title = "API Design"
author = ["Hrishikesh Barman"]
draft = false
+++

tags
: [Distributed Systems]({{< relref "20221102130004-distributed_systems.md" >}}), [Systems]({{< relref "20221101150250-systems.md" >}}), [Web Development]({{< relref "20221108105344-web_development.md" >}}), [Design Patterns]({{< relref "20221125204047-design_patterns.md" >}}), [Authentication]({{< relref "20230301191046-authentication.md" >}}), [HTTP]({{< relref "20230222161545-http.md" >}})


## API Endpoint security {#api-endpoint-security}


### Tokens {#tokens}

-   An authorization token is just a string that is used to authorize a request.
-   It can be
    -   A [JWT]({{< relref "20230301214248-jwt.md" >}}) (so-called pass-by-value tokens)
    -   A random identifier (so-called pass-by-reference tokens)
    -   Something else
-   In the wild they call it, API keys, Personal access tokens etc.
-   These are **not necessarily** outcome of the [OAuth (Open Authorization)]({{< relref "20230301205620-authorization.md#oauth--open-authorization" >}}) Flow.


### OAuth and Protecting APIs {#oauth-and-protecting-apis}

-   OAuth is abused as a way of protecting your API but still widely used.
-   Use the `Authorization Code grant` if there is a **human being** involved.
-   Use the `Client Credentials grant` if you are performing **server to server** communication.
-   Benefits of using OAuth in APIs
    -   Time limited (rotation built in).
    -   If using signed tokens, integrity of contents can be verified.
    -   Lots of libraries and knowledge around how to use it.
    -   Tokens allow for more interesting/useful payloads than an API key.
-   [OAuth (Open Authorization)]({{< relref "20230301205620-authorization.md#oauth--open-authorization" >}}) access tokens are a subcategory of tokens
-   [Best practices for REST API security: Authentication and authorization](https://stackoverflow.blog/2021/10/06/best-practices-for-authentication-and-authorization-for-rest-apis/)
-   [The complete guide to protecting your APIs with OAuth2 (part 1)](https://stackoverflow.blog/2022/12/22/the-complete-guide-to-protecting-your-apis-with-oauth2/)


### Exposing API {#exposing-api}

-   API gateways like [Kong](https://github.com/kong/kong)
-   Custom service


### Native APIs {#native-apis}

-   One can use session tokens to [access native APIs.](https://www.ory.sh/kratos/docs/concepts/session/)


## Protecting API {#protecting-api}

This comes down to a data question

-   If data is personal
    -   Implement some sort of authentication and authorization
-   If the data is public
    -   Run on the assumption someone will find a way to extract it.
    -   CORS will help, no?
        -   [CORS]({{< relref "20230302210256-cors.md" >}}) is not a rate limiting mechanism, it's a way to get around browser limitations.
        -   Doesn't matter what [CORS]({{< relref "20230302210256-cors.md" >}}) configuration you set on the API endpoint, it'll always be fully accessible from a non-browser thing. (eg. curl)
    -   Consider API gateways
        -   Track the usage pattern of requests
        -   Rate limit to a point where automated data extraction is too slow.
