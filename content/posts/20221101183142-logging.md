+++
title = "Logging"
author = ["Hrishikesh Barman"]
draft = false
+++

tags
: [Operating Systems]({{< relref "20221101172456-operating_systems.md" >}}), [Systems]({{< relref "20221101150250-systems.md" >}}), [Linux]({{< relref "20221101150211-linux.md" >}})


## Writers/Sources {#writers-sources}


### systemd journal {#systemd-journal}

-   `systemd` needs to be there
-   `systemd` services. When they log to `stderr` / `stdout`, `journald` picks them up and writes them in binary format into it's journal.
-   Usually stored in `/var/log/journal` in binary, use `journalctl` to view
-   `journald` can forward all its messages to `syslog` if needed


### syslog {#syslog}

-   Usually the case when there's no `systemd`
-   Services can write to `/dev/log` in the `syslog` format
-   A syslog daemon(eg. `rsyslog`, `syslog-ng`) picks it and writes it to destinations(could be file/others)
-   By default writes `files` to `/var/log`
-   Because it's file based, we'll probably need to use something like `logrotate`
-   History
    -   `syslog` project first. It started in 1980. Birthed the syslog protocol. UDP only.
    -   `syslog-ng` came in 1998. TCP support, encryption etc.
    -   `rsyslog` came in 2004. Extends `syslog-ng`


### kernel {#kernel}

-   Writes its own logs to a ring buffer.
-   `journald` or `syslog` daemons  can read logs from this buffer then write to `files` or `journal`
-   `dmesg` can be used to view these
-   **Audit Logs**: [Special case](https://wiki.archlinux.org/title/Audit_framework) of kernel messages designed for auditing actions such as file access. Probably can [be replaced](https://goteleport.com/blog/linux-audit/) by BPF.


## Applications {#applications}


### Logging to `stdout` / `stderr` {#logging-to-stdout-stderr}

-   [Logging: The Twelve-Factor App](https://12factor.net/logs)

On systems with systemd...

-   if you write to stderr/stdout and is running with systemd it will log to systemd-journal. That's just the way it works.
-   More and more, I think the only time you want your program dealing with log files directly is if you have a need for specific multiple logs. But even then, it seems like adding labels or tags to your log stream would be the better.
-   Even in non-containerized apps, it seems writing to stdout/stderr is the way to go these days. If it's something designed to be daemonized, letting whatever executes the process (systemd for example) can be told where to send the logs, defaulting to a common location like /var/log/syslog. If it's running inside a docker container or k8s, they have their own way to send logs.


## Centralized logging {#centralized-logging}


### Log collector {#log-collector}

-   `journald`
-   `syslog-ng` / `rsyslogd`


### Log routers {#log-routers}

People call these by different names.

-   `journald-upload`
-   Fluend
-   Logstash
-   Filebeat
-   Promtail


### Central logging {#central-logging}

-   ELK stack, Graylog, splunk, datadog, Loki etc.
-   [Sending logs from syslog-ng to Grafana Loki - Blog - syslog-ng Community - sy...](https://www.syslog-ng.com/community/b/blog/posts/sending-logs-from-syslog-ng-to-grafana-loki)
