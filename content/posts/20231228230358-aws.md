+++
title = "AWS"
author = ["Hrishikesh Barman"]
draft = false
+++

tags
: [Infrastructure]({{< relref "20221101183735-infrastructure.md" >}}), [Containers]({{< relref "20230218104617-containers.md" >}}), [Kubernetes]({{< relref "20221102125748-kubernetes.md" >}}), [Terraform]({{< relref "20231229022230-terraform.md" >}})


## FAQ {#faq}


### EBS what? {#ebs-what}

-   EBS can be confusing
-   Elastic Beanstalk (EB)
-   Elastic Block Storage (EBS)
-   Proper use is EB and EBS


### Deploying containers on AWS {#deploying-containers-on-aws}

-   See [Containers on AWS](https://containersonaws.com/)
-   See [17 More Ways to Run Containers on AWS](https://archive.is/H2F9k)
-   See [Concurrency Compared: Lambda, App Runner, AWS Fargate](https://nathanpeck.com/concurrency-compared-lambda-fargate-app-runner/)
-   `K8s on EC2 / EKS`: Extremely robust, scalable, and need tight controls over your containers.
-   `Docker Swarm on EC2`: Simple orchestration but still want to manage it.
-   `ECS on EC2`: Ease of use and want access to your hosts
-   `ECS on Fargate`: Never think about anything other than the container
-   `Plain EC2 with docker/docker-compose`: This is where you manually install docker and docker-compose on EC2. You can do this but I'd prefer using ECS with EC2 instead.
-   `EC2+Beanstalk+Docker`: Can be done but pretty cumbersome.
-   `docker on lightsail`
-   `lightsail container service`
-   `Apprunner`


### Spot Instances? {#spot-instances}

This allows running fault-tolerant workloads at a much cheaper price

-   EC2 Spot instances
-   Fargate Spot instances


## Concepts {#concepts}


### Security Groups {#security-groups}


### AMI {#ami}

-   Amazon Machine Image
-   pre-configured virtual machine image, used to create and launch instances within Amazon Elastic Compute Cloud (EC2).


### IAM Roles {#iam-roles}

See [IAM (Identity and Access Management)]({{< relref "20231102172218-iam.md" >}})


#### ARN {#arn}


### Load Balancers {#load-balancers}


#### Offerings {#offerings}

<!--list-separator-->

-  ELB / CLB (Not recommended)

    -   Elastic [Load Balancers]({{< relref "20230215194922-load_balancers.md" >}})
    -   aka CLB (Classic LB)
    -   Did both L4 and L7 load balancing
    -   Lot [of limitations](https://iamondemand.com/blog/elb-vs-alb-vs-nlb-choosing-the-best-aws-load-balancer-for-your-needs/), ALB and NLB are newer.

<!--list-separator-->

-  ALB (L7)

    -   Primary purpose of alb is to split traffic for the `same route` between `different backends`.
    -   Also rule based routing. (AWS API Gateway(AGW) only does this)

<!--list-separator-->

-  NLB (L4)


#### What about [reverse proxies]({{< relref "20230212101521-proxies.md" >}})? {#what-about-reverse-proxies--20230212101521-proxies-dot-md}

Options are either of:

-   NLB + nginx/traefik/caddy etc
-   ALB + LB controller(if using [Kubernetes]({{< relref "20221102125748-kubernetes.md" >}}))

Additionally:

-   We can still use a reverse proxy + ALB, but that's [usually not necessary.](https://www.reddit.com/r/aws/comments/f5ttaj/ideal_setup_of_ecs_cluster_with_traefik_and_alb/)
    -   [Traefik Proxy in AWS with AWS ECS - Part 1 â€” Compose-X Labs documentation](https://labs.compose-x.io/apps/traefik_ecs_part1.html)
    -   [Traefik AWS ECS Documentation - Traefik](https://doc.traefik.io/traefik/providers/ecs/)
-   For ECS anywhere an [external load balancer](https://aws.amazon.com/blogs/containers/implementing-application-load-balancing-of-amazon-ecs-anywhere-workloads-using-traefik-proxy/) may be useful.


#### Target Groups {#target-groups}


### ASG (Auto Scaling Groups) {#asg--auto-scaling-groups}


## Services {#services}


### EC2 {#ec2}

-   `Security Groups` are the [Firewalls]({{< relref "20230306125249-firewalls.md" >}}) of EC2


### ECS {#ecs}

-   A [Container]({{< relref "20230218104617-containers.md" >}}) orchestration tool/layer
-   We can have multiple ECS clusters
-   Alternative: [Kubernetes]({{< relref "20221102125748-kubernetes.md" >}}), Docker Swarm
-   Is free, You pay for the underlying host(ec2/fargate)
-   ECS will allow you to deploy a wide variety of containers on a number of instances and automatically handles the complexity of container placement and lifecycle for you. This is useful compared to using docker-compose on your ec2 instance.
-   Handles Services&amp;Task Definitions


#### Additional notes {#additional-notes}

-   ECS can integrate with other AWS services like load balancers, but they leave that completely up to you. It'll just orchestrate your stuff. Unlike EBS it'll not put a loadbalancer etc for you.
-   Passing runtime configurations for images as it doesn't have ConfigMaps like [Kubernetes]({{< relref "20221102125748-kubernetes.md" >}})
    -   SSM parameters like [this image](https://hub.docker.com/r/rdkls/kong_ssm/)
    -   [init container + s3](https://github.com/aws-samples/amazon-ecs-configmaps-example/blob/main/README.md)


#### Flavors {#flavors}

-   ECS on EC2
    -   EC2 instance need to install the ECS agent/AMI
    -   Resources in EC2 might be over-provisioned if the container does not use most of it
    -   You can also have it manage ASGs of your own EC2 instances
-   ECS on Fargate
    -   Managed
    -   If we configure properly only the resources needed for the container will be used.
    -   Uses Firecracker (See [Virtualization]({{< relref "20221101183016-virtualization.md" >}}), [Containers]({{< relref "20230218104617-containers.md" >}}), [OCI Ecosystem]({{< relref "20230603000641-oci_ecosystem.md" >}}))


### Elastic Beanstalk (EBS) {#elastic-beanstalk--ebs}

-   Beanstalk is a Platform as a Service (PaaS) offering
-   Puts the application in a autoscaling group by default?
-   Also will deploy a load-balancer.
-   It spins up a few opinionated services under the covers for you in an attempt to make deploying your application easier. (may not be desirable)
-   It's like heroku from AWS


### Elastic Block Storage (EBS) vs Elastic File System (EFS) {#elastic-block-storage--ebs--vs-elastic-file-system--efs}


### Lightsail {#lightsail}

See [Compare Amazon EC2 and Amazon Lightsail | AWS re:Post](https://repost.aws/knowledge-center/lightsail-differences-from-ec2)

-   Easiest way to run a virtual machine on AWS.
-   Good if you simply want to host simple one-off webapps/custom code etc.
-   Has restrictions on features and capabilities versus ec2.
-   Has a lightsail specific loadbalancer
-   No autoscaling
-   Network
    -   Managed by AWS
    -   No concept of private subnet
    -   w EC2 user gets to configure the VPC.


#### Lightsail container services {#lightsail-container-services}

-   This is priced different offering than lightsail instances but falls under the lightsail umbrella.
-   It's very simplified container deployment, image url and port, that's all.
-   Under the hood, ECS power lightsail container services.


### AppRunner {#apprunner}


### Cloudfront {#cloudfront}

CDN


### API gateway (AGW) {#api-gateway--agw}

-   See [CORS]({{< relref "20230302210256-cors.md" >}}), alternative could be selfhosting something like Kong
-   API gateway's primary purpose is rule based routing.
-   Once you get beyond a low number of requests, it becomes a lot more expensive than an ALB,
-   Features
    -   Rate Limiting
    -   Authorizers
    -   B/G Deployments


#### CDN/Cloudfront infront of API Gateway? {#cdn-cloudfront-infront-of-api-gateway}

Useful for couple of reasons:

-   Caching: Even if API gateway may have its own caching, could be expensive
-   Clients will connect to the nearest point of contact
-   HTTPS ([TLS]({{< relref "20230210181907-tls.md" >}})) negotiations happens in the nearest point reducing latency


### ACM (AWS Certificate Manager) {#acm--aws-certificate-manager}
